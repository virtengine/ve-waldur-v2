# Generated by Django 2.2.13 on 2020-10-07 11:12

from django.contrib.contenttypes.models import ContentType
from django.db import migrations


def delete_catalogs(apps, schema_editor):
    Catalog = apps.get_model('waldur_rancher', 'Catalog')

    for catalog in Catalog.objects.all():
        if not catalog.content_type or not catalog.object_id:
            catalog.delete()

        ct = ContentType.objects.get(pk=catalog.content_type_id)
        klass = apps.get_model(ct.app_label, ct.model)

        try:
            klass.objects.get(id=catalog.object_id)
        except klass.DoesNotExist:
            catalog.delete()


class Migration(migrations.Migration):

    dependencies = [
        ('waldur_rancher', '0033_error_traceback'),
        ('contenttypes', '0002_remove_content_type_name'),
    ]

    operations = [
        migrations.RunPython(delete_catalogs),
    ]
